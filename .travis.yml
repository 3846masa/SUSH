branches:
  except:
    - '/^v\d+\.\d+\.\d+$/'

language: node_js
node_js:
  - "6"
cache:
  yarn: true
dist: trusty
sudo: false

addons:
  apt:
    packages:
      - google-chrome-stable

env:
  global:
    - DISPLAY=:99.0
    - CHROME_BIN=/usr/bin/google-chrome

before_script:
  # For Git
  - git config --global user.email "3846masahiro+git@gmail.com"
  - git config --global user.name "3846masa"
  - git config --global push.default simple
  - git remote set-url origin "https://${GH_USERNAME}:${GH_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git"
  - git fetch origin $TRAVIS_BRANCH
  - git checkout $TRAVIS_BRANCH

  # Update npm
  - npm i -g npm
  - npm config set "//registry.npmjs.org/:_authToken=${NPM_TOKEN}"
  - npm whoami

  # For Chrome
  - sh -e /etc/init.d/xvfb start

script:
  - yarn run test
  - yarn run report

after_success:
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" = "develop" ]; then yarn run release; fi
